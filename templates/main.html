<!DOCTYPE html>
<html>
    <head>
      <!-- Global site tag (gtag.js) - Google Analytics -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=UA-125060974-1"></script>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-125060974-1');
      </script>

    
        <link rel="stylesheet"
              href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
              integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
              crossorigin="anonymous">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title> Find your professor </title>

        <style>

        .venue {
            border-bottom: 1px solid #DEE2E6;
            padding: 10px;
        }

        .venue:nth-last-child(1) {
            border-bottom: 0;
        }
        
        .venue:only-child {
            border: 0;
        }

        </style>
    </head>
    <div class="container-fluid-nav text-center">
              <nav class="navbar navbar-expand-lg navbar-light bg-light">
                <img src="{{ url_for('static', filename='iiitb_logo.png') }}" alt="IIIT-B">
                </button>
                <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
                  <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
                    <li class="nav-item active">
                      <a class="nav-link" href="#"><span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item"> 
                        <h1  class="text-center" style="color:#015483; margin-left:780px;">Faculty TimeTable</h1>                  
                    </li>
                    <li class="nav-item">
                      <a class="nav-link disabled" href="#"></a>
                    </li>
                  </ul>
                  <div class="form-inline my-2 my-lg-0">
                   <span><a class="nav-link" href="/"><h3>Home</h3></a></span>
                  </div>
                </div>
              </nav>
        </div> 
        </div>
      </nav>
    <body>
        <div class="container" style="margin-top:5px">
            <div class="row">
                <div class="col-md-2">
                </div>
                <div class="col-md-8">
                    <br>
                    <p>
                    Select a name to see the weekly timetable of the
                    professor!
                    </p>
                    {% if name %}
                        <input name="prof"  autocomplete="off"
                                            placeholder="Who are you looking for?"
                                            class="form-control" id="prof_query" value="{{name}}">
                    {% else %}
                        <input name="prof"  autocomplete="off"
                                            placeholder="Who are you looking for?"
                                            class="form-control" id="prof_query">
                    {% endif %}
                    <div id="suggestions">
                        <ul class="list-group">
                        </ul>
                    </div>
                </div>
                <div class="col-md-2">
                </div>
            </div>
            <script type=text/javascript>
                $(function() {
                    $('a#ics').bind('click', function() {
                        $.get('/ics_helper', function(data){
                            // do nothing
                        });
                        return false;    
                    });
                });
            </script> 
            <div class="row">
                {% if not error %}
                    {% if name %}
                    <h3 class="display-4" style="margin-top: 2%;"> <a href="{{ website }}" target="_blank"> {{ name }} </a> | {{ dept }} </h3>
                    <table class="table table-striped table-bordered table-hover
                    text-center">
                        <thead class="thead-light">
                            <tr>
                                {% for time in times %}
                                <th class="col-md-1"> {{time}} </th>
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in data %}
                            <tr>
                                {% for col in row %}
                                {% set outer_loop = loop %}
                                <td class="col-md-1" style="padding: 0;">
                                    {% for venue in col %}
                                    <div class="venue">
                                        {{ venue }}
                                        {% if outer_loop.index > 1 %}
                                            {{ course }}
                                        {% endif %}
                                    </div>
                                    {% endfor %}
                                </td>
                                {% endfor %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>

                    <form action = "/ics_helper">
                        <button class='btn btn-default'>Download as ics</button>
                    </form>
                    {% endif %}
                {% endif %}

                {% if error %}
                <div style="margin-top: 4%; margin-bottom: 4%" class="container-fluid">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="error-template text-center">
                                <h1>Oops!</h1>
                                <h2>Professor Not Found!</h2>
                                <div class="error-details">
                                        Sorry, we're unable to find the professor that you searched
                                        for! Check the spelling of the professor's name. If you are
                                        still unable to find their timetable, then ERP doesn't
                                        contain their data.
                                </div>
                                <script>
                                    document.getElementById("prof_query").focus();
                                </script>
                            </div>
                        </div>
                        <div class="col-md-3">
                        </div>
                    </div>
                </div>

                {% endif %}

                <script>
                    var fullLink = window.location.href;
                    console.log(fullLink)
                    var splitLink = fullLink.split('=');
                    if (splitLink.length>1) {
                         searchQuery = splitLink[1].replace(/%20/g, " ");
                         var inputBox = document.getElementById("prof_query");
                         inputBox.value=searchQuery;
                         inputBox.focus();
                     }
                </script>
            </div>
        </div>


        <script src="{{url_for('static', filename='scripts/autocomplete.js')}}"></script>
        <script>
            var datalist = [{% for prof in profs %} '{{prof}}', {% endfor %}];        
            var worker = new Worker("{{url_for('static', filename='scripts/worker.js')}}");
            autocomplete(datalist, worker);
        </script>
    </body>
</html>
